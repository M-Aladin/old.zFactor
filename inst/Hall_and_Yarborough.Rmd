---
title: "Hall and Yarborough"
output: 
  html_document: 
    fig_caption: yes
---


```{r setup, include=F, error=T, message=F, warning=F}
knitr::opts_chunk$set(echo=T, comment=NA, error=T, warning=F, message = F, fig.align = 'center')
```



## From paper by Kareem, Iwalezawa and Al-Marhoun
Link to paper: https://www.dropbox.com/s/xiaijtokwsu5ykt/JPT%206481%E2%80%93492%20New%20explicit%20correlation%20for%20the%20compressibility%20factor%20of%20natural%20gas%20%5B5star%20petroleum%20zfactor%5D.pdf?dl=0



![](./images/eq_7_HY_LIM482.jpg)



## From book Guo, Lyons, Galambor, Petroleum Production Eng.
The equations are OK bt in the worksheet they use $P_{pr}$ to find $T_{pr}$.
The Excel workshet is included in this repository for analysis.


![](./images/eq_2-52_HY_GLG35.jpg)



## From paper by Fatoorehchi, Abolghasemi, Rach and Assar
Link to paper: https://www.dropbox.com/s/3982pt63hi32p6c/10.1002%20cjce.22054%20-%20fatoorehchi2014.pdf?dl=0

![](./images/eq_1-3-HY_FARA.jpg)


### Example 1. Fatoorechi paper
Find z given the data below:

    Temperature = 366.5 K = 200 F
    Pressure = 13.7895 MPa = 2000 psia
    Gas specific gravity = 0.7 
    yN2 = 0.05 
    yCO2 = 0.05 
    yH2S = 0.02 

We convert to oilfield units (Farenheit and psia).

```{r}
library(rNodal)

# Example 1 in Fantoorechi paper

print(z.hallyarborough(pres.a = 2000, temp.f = 200, gas.sg = 0.7,
                       n2.frac = 0.05, co2.frac = 0.05, h2s.frac = 0.02))
```

If we compare the value obtained with the value in the paper:

Using equation for impurities in gas:

![](./images/eq_10_11-HY_FARA.jpg)

From the paper, $z(NR) = 0.8362$.

Let's use the internal function `z.hallyarboroughL`

```{r}
# use the internal function z.hallyarboroughL
print(rNodal:::z.hallyarboroughL(pres.a = 2000, temp.f = 200, gas.sg = 0.7,
                       n2.frac = 0.05, co2.frac = 0.05, h2s.frac = 0.02))
```

```{r}
gas.sg <- 0.7
n2.frac = 0.05
co2.frac = 0.05
h2s.frac = 0.02

temp.pc <- 326 + 315.7 * (gas.sg - 0.5) - 240 * n2.frac -
              83.3 * co2.frac + 133.3 * h2s.frac
print(temp.pc)
# 375.61 R = 208.6894 K
```




```{r}
# from Fatorechi paper:
# Table 1, Example 1 solution
pres.pc.M <- 4.7697  # Mpa

# All temperatures in Kelvin
temp.K    <- 366.5   # Kelvin
temp.pc.K <- 208.6   # Kelvin
temp.r <-  temp.pc.K / temp.K
print(temp.r)
```


```{r}
# All temperatures in Rankine
temp.R <- temp.F + 460
temp.r <- temp.pc / temp.R
print(temp.r)
```



```{r}
# from the solution in Example 1, Fatoorechi
temp.pc.K <- 208.6 # Kelvin
temp.r    <- 0.617678
temp.K <-  temp.pc.K / temp.r
print(temp.K)
```


## Example 2 from Fatoorechi paper

Temperature = 355.4 K = 180 F\
Pressure = 34.4747 MPa = 5000 psi\
Gas specific gravity = 0.65 \
yN2 = 0.1 \
yCO2 = 0.08 \
yH2S = 0.02 \


```{r}
library(rNodal)

# Example 2 in Fantoorechi paper

print(z.hallyarborough(pres.a = 5000, temp.f = 180, gas.sg = 0.65,
                       n2.frac = 0.1, co2.frac = 0.08, h2s.frac = 0.02))
```


```{r}
# From the paper 
z.paper <- 1.0002 
```




## Example 3 from Fatoorechi paper

Temperature = 310.9 K = 100 F\
Pressure = 6.8947 MPa = 1000 psi\
Gas specific gravity =  \
Tpc = 237.2 K  = -32.71 F = 427.29 R\
Ppc = 4.4815 MPa = 650 psia \

```{r}
print(rNodal:::z.hallyarboroughL(pres.a = 1000, temp.f = 100, gas.sg = 0.82))
# z = 0.760227
# from paper, z = 0.7557
```



```{r}
source("../R/HY.R")

# supplying gas.sg
with_gas.sg <- c(method = "use_gas.sg", z.hallyarboroughL(pres.a = 1000, temp.f = 100, gas.sg = 0.82))
# z = 0.760227
# pres.pc = 662
# temp.pc = 427.024

# no gas.sg provided
with_pseudo_crit <- c(method = "use_pseudo_critical", z.hallyarboroughL(pres.a = 1000, temp.f = 100,  pres.pc = 662, temp.pc = 427))
names(with_pseudo_crit)

# no gas.sg provided
with_pseudo_red <- c(method = "use_pseudo_reduced", z.hallyarboroughL(pres.a = 1000, temp.f = 100,  pres.pr = 1.51, temp.pr = 1.31))
names(with_pseudo_red)

df <- data.frame(stringsAsFactors = FALSE)
df <- rbind(df, with_gas.sg, with_pseudo_crit, with_pseudo_red)
```







```{r}
fMulti <- function(a, b, c, d) {
    if (missing(d)) {
        d <- 1
        e <- a * b *c
        print(match.call())
    }
    return(e)
}

fMulti(1,2,3)
```



